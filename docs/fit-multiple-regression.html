<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Using lm for multiple regression | Data Fluency</title>
  <meta name="description" content="Using lm for multiple regression | Data Fluency" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Using lm for multiple regression | Data Fluency" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Using lm for multiple regression | Data Fluency" />
  
  
  

<meta name="author" content="Ben Whalley and Chris Berry" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="regression-interaction.html">
<link rel="next" href="uncertainty.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<link href="media/webex.css" rel="stylesheet" />
<link href="media/psystats.css" rel="stylesheet" />
<script src="media/webex.js"></script>
<script src="media/psystats.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118343766-4"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-118343766-4');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Fluency</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="approach-of-this-course.html"><a href="approach-of-this-course.html"><i class="fa fa-check"></i>Approach of this course</a></li>
<li class="chapter" data-level="" data-path="format-of-the-sessions.html"><a href="format-of-the-sessions.html"><i class="fa fa-check"></i>Format of the sessions</a></li>
<li class="chapter" data-level="" data-path="the-most-important-thing-of-all.html"><a href="the-most-important-thing-of-all.html"><i class="fa fa-check"></i>The most important thing of all</a></li>
<li class="chapter" data-level="" data-path="list-of-sessions.html"><a href="list-of-sessions.html"><i class="fa fa-check"></i>List of sessions</a></li>
<li class="chapter" data-level="" data-path="access-to-r.html"><a href="access-to-r.html"><i class="fa fa-check"></i>Access to R</a></li>
<li class="chapter" data-level="" data-path="reasons-to-use-r.html"><a href="reasons-to-use-r.html"><i class="fa fa-check"></i>Why do we use R?</a></li>
<li class="chapter" data-level="" data-path="teachers-notes.html"><a href="teachers-notes.html"><i class="fa fa-check"></i>Teachers’ notes</a></li>
<li class="chapter" data-level="" data-path="week-by-week-resources.html"><a href="week-by-week-resources.html"><i class="fa fa-check"></i>Week-by-week resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assessments.html"><a href="assessments.html"><i class="fa fa-check"></i>Assessments</a><ul>
<li class="chapter" data-level="" data-path="core-skills-test.html"><a href="core-skills-test.html"><i class="fa fa-check"></i>Core skills test</a></li>
<li class="chapter" data-level="" data-path="analysis-and-visualisation-task.html"><a href="analysis-and-visualisation-task.html"><i class="fa fa-check"></i>Analysis and visualisation task</a></li>
<li class="chapter" data-level="" data-path="assessment-authentic-analysis.html"><a href="assessment-authentic-analysis.html"><i class="fa fa-check"></i>Authentic analysis assessment</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="beginners.html"><a href="beginners.html"><i class="fa fa-check"></i>BeginneRs</a><ul>
<li class="chapter" data-level="" data-path="getting-started-rstudio.html"><a href="getting-started-rstudio.html"><i class="fa fa-check"></i>Getting started with RStudio</a></li>
<li class="chapter" data-level="" data-path="exploring-data-brief.html"><a href="exploring-data-brief.html"><i class="fa fa-check"></i>Exploring data (in brief)</a></li>
<li class="chapter" data-level="" data-path="inspecting-data.html"><a href="inspecting-data.html"><i class="fa fa-check"></i>Inspecting data</a></li>
<li class="chapter" data-level="" data-path="missing-data.html"><a href="missing-data.html"><i class="fa fa-check"></i>Missing data</a></li>
<li class="chapter" data-level="" data-path="group-differences-briefly.html"><a href="group-differences-briefly.html"><i class="fa fa-check"></i>Group differences (briefly)</a></li>
<li class="chapter" data-level="" data-path="undergraduate-stats-in-r.html"><a href="undergraduate-stats-in-r.html"><i class="fa fa-check"></i>Undergraduate stats in R</a></li>
<li class="chapter" data-level="" data-path="sequences-and-designs.html"><a href="sequences-and-designs.html"><i class="fa fa-check"></i>Sequences and designs</a></li>
<li class="chapter" data-level="" data-path="more-reading-data.html"><a href="more-reading-data.html"><i class="fa fa-check"></i>Reading data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualisation.html"><a href="visualisation.html"><i class="fa fa-check"></i>Visualisation and plotting</a><ul>
<li class="chapter" data-level="" data-path="session1.html"><a href="session1.html"><i class="fa fa-check"></i>Session 1</a></li>
<li class="chapter" data-level="" data-path="countries-200-years.html"><a href="countries-200-years.html"><i class="fa fa-check"></i>200 countries, 200 years…</a></li>
<li class="chapter" data-level="" data-path="into-the-third-and-fourth-and-fifth-dimension.html"><a href="into-the-third-and-fourth-and-fifth-dimension.html"><i class="fa fa-check"></i>Into the third (and fourth, and fifth…) dimension</a></li>
<li class="chapter" data-level="" data-path="layers.html"><a href="layers.html"><i class="fa fa-check"></i>Layers</a></li>
<li class="chapter" data-level="" data-path="facets.html"><a href="facets.html"><i class="fa fa-check"></i>Facets</a></li>
<li class="chapter" data-level="" data-path="ggplot-scales.html"><a href="ggplot-scales.html"><i class="fa fa-check"></i>Scales</a></li>
<li class="chapter" data-level="" data-path="comparing-categories.html"><a href="comparing-categories.html"><i class="fa fa-check"></i>Comparing categories</a></li>
<li class="chapter" data-level="" data-path="spit-and-polish.html"><a href="spit-and-polish.html"><i class="fa fa-check"></i>Spit and polish</a></li>
<li class="chapter" data-level="" data-path="session-2-real-world-plots.html"><a href="session-2-real-world-plots.html"><i class="fa fa-check"></i>Session 2: Real world plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-handling.html"><a href="data-handling.html"><i class="fa fa-check"></i>Data handling</a><ul>
<li class="chapter" data-level="" data-path="overview-1.html"><a href="overview-1.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="making-new-variables.html"><a href="making-new-variables.html"><i class="fa fa-check"></i>Making new variables</a></li>
<li class="chapter" data-level="" data-path="reshaping-melting.html"><a href="reshaping-melting.html"><i class="fa fa-check"></i>Reshaping (melting)</a></li>
<li class="chapter" data-level="" data-path="reshaping-wide-casting.html"><a href="reshaping-wide-casting.html"><i class="fa fa-check"></i>Reshaping wide (casting)</a></li>
<li class="chapter" data-level="" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i>RMarkdown</a></li>
<li class="chapter" data-level="" data-path="final-task-to-be-completed-as-homework.html"><a href="final-task-to-be-completed-as-homework.html"><i class="fa fa-check"></i>Final task (to be completed as homework)</a></li>
<li class="chapter" data-level="" data-path="extension-exercises-and-reading.html"><a href="extension-exercises-and-reading.html"><i class="fa fa-check"></i>Extension exercises and reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i>Regression</a><ul>
<li class="chapter" data-level="" data-path="session-1.html"><a href="session-1.html"><i class="fa fa-check"></i>Session 1</a></li>
<li class="chapter" data-level="" data-path="how-useful-are-the-lines.html"><a href="how-useful-are-the-lines.html"><i class="fa fa-check"></i>How useful are the lines?</a></li>
<li class="chapter" data-level="" data-path="using-r-for-regression.html"><a href="using-r-for-regression.html"><i class="fa fa-check"></i>Using R for regression</a></li>
<li><a href="the-first-step-is-always-plotting.html#the-first-step-is-always-plotting">The first step is <strong>always</strong> plotting</a></li>
<li class="chapter" data-level="" data-path="automatic-line-fitting.html"><a href="automatic-line-fitting.html"><i class="fa fa-check"></i>Automatic line-fitting</a></li>
<li class="chapter" data-level="" data-path="first-lm.html"><a href="first-lm.html"><i class="fa fa-check"></i>Putting numbers to lines</a></li>
<li class="chapter" data-level="" data-path="regresion-hand-predictions.html"><a href="regresion-hand-predictions.html"><i class="fa fa-check"></i>Making predictions (by hand)</a></li>
<li class="chapter" data-level="" data-path="regression-thinking-causes.html"><a href="regression-thinking-causes.html"><i class="fa fa-check"></i>Thinking about causes</a></li>
<li class="chapter" data-level="" data-path="moderation-intro.html"><a href="moderation-intro.html"><i class="fa fa-check"></i>‘Effect modification’</a></li>
<li class="chapter" data-level="" data-path="tricky-relationships.html"><a href="tricky-relationships.html"><i class="fa fa-check"></i>‘Tricky’ relationships</a></li>
<li class="chapter" data-level="" data-path="diagrams-and-models.html"><a href="diagrams-and-models.html"><i class="fa fa-check"></i>Diagrams and models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i>Multiple regression</a><ul>
<li class="chapter" data-level="" data-path="why-multiple-regression.html"><a href="why-multiple-regression.html"><i class="fa fa-check"></i>Why use multiple regression?</a></li>
<li class="chapter" data-level="" data-path="regression-interaction.html"><a href="regression-interaction.html"><i class="fa fa-check"></i>Different relationships?</a></li>
<li><a href="fit-multiple-regression.html#fit-multiple-regression">Using <code>lm</code> for multiple regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i>Uncertainty</a><ul>
<li class="chapter" data-level="" data-path="overview-3.html"><a href="overview-3.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="calculating-intervals.html"><a href="calculating-intervals.html"><i class="fa fa-check"></i>Calculating intervals</a></li>
<li class="chapter" data-level="" data-path="recap-on-intervals.html"><a href="recap-on-intervals.html"><i class="fa fa-check"></i>Recap on intervals</a></li>
<li class="chapter" data-level="" data-path="beyond-intervals-extension-exercises.html"><a href="beyond-intervals-extension-exercises.html"><i class="fa fa-check"></i>Beyond intervals (extension exercises)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fitting-curves.html"><a href="fitting-curves.html"><i class="fa fa-check"></i>Fitting curves</a><ul>
<li class="chapter" data-level="" data-path="session-1-1.html"><a href="session-1-1.html"><i class="fa fa-check"></i>Session 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-models.html"><a href="building-models.html"><i class="fa fa-check"></i>Building models</a><ul>
<li class="chapter" data-level="" data-path="session-1-multiple-regression.html"><a href="session-1-multiple-regression.html"><i class="fa fa-check"></i>Session 1: Multiple regression</a></li>
<li class="chapter" data-level="" data-path="session-2-anova-and-bayes-factor.html"><a href="session-2-anova-and-bayes-factor.html"><i class="fa fa-check"></i>Session 2: Anova and Bayes Factor</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i>Testing</a><ul>
<li><a href="session-1-planned-contrasts-with-emmeans.html#session-1-planned-contrasts-with-emmeans">Session 1: Planned contrasts with <code>emmeans</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="communicating-results.html"><a href="communicating-results.html"><i class="fa fa-check"></i>Communicating results</a><ul>
<li class="chapter" data-level="" data-path="session-1-communicating-anova-and-regression.html"><a href="session-1-communicating-anova-and-regression.html"><i class="fa fa-check"></i>Session 1: Communicating Anova and Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="real-world-data.html"><a href="real-world-data.html"><i class="fa fa-check"></i>Real world data</a><ul>
<li class="chapter" data-level="" data-path="session-1-reproducing-a-real-paper.html"><a href="session-1-reproducing-a-real-paper.html"><i class="fa fa-check"></i>Session 1: Reproducing a real paper</a></li>
<li class="chapter" data-level="" data-path="session-2-reproducing-a-real-paper.html"><a href="session-2-reproducing-a-real-paper.html"><i class="fa fa-check"></i>Session 2: Reproducing a real paper</a></li>
<li class="chapter" data-level="" data-path="session-3-reproducing-a-real-paper.html"><a href="session-3-reproducing-a-real-paper.html"><i class="fa fa-check"></i>Session 3: Reproducing a real paper</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="extras.html"><a href="extras.html"><i class="fa fa-check"></i>Extras</a><ul>
<li class="chapter" data-level="" data-path="keyboard-shortcuts.html"><a href="keyboard-shortcuts.html"><i class="fa fa-check"></i>Keyboard shortcuts</a></li>
<li class="chapter" data-level="" data-path="common-problems.html"><a href="common-problems.html"><i class="fa fa-check"></i>Common problems</a></li>
<li class="chapter" data-level="" data-path="cheatsheet.html"><a href="cheatsheet.html"><i class="fa fa-check"></i>Cheatsheet</a></li>
<li class="chapter" data-level="" data-path="sample-n.html"><a href="sample-n.html"><i class="fa fa-check"></i>More sampling</a></li>
<li class="chapter" data-level="" data-path="more-on-tibbles.html"><a href="more-on-tibbles.html"><i class="fa fa-check"></i>More on Tibbles</a></li>
<li class="chapter" data-level="" data-path="regression-extra-explanations.html"><a href="regression-extra-explanations.html"><i class="fa fa-check"></i>Regression - extra explanations</a></li>
<li class="chapter" data-level="" data-path="bayesian-estimation-of-the.html"><a href="bayesian-estimation-of-the.html"><i class="fa fa-check"></i>Bayesian estimation of the</a></li>
<li class="chapter" data-level="" data-path="confidence-intervals-explanation.html"><a href="confidence-intervals-explanation.html"><i class="fa fa-check"></i>What do confidence intervals mean?</a></li>
<li class="chapter" data-level="" data-path="bayesian-estimation-of-the-1.html"><a href="bayesian-estimation-of-the-1.html"><i class="fa fa-check"></i>Bayesian estimation of the</a></li>
<li class="chapter" data-level="" data-path="other-tips.html"><a href="other-tips.html"><i class="fa fa-check"></i>Other tips</a></li>
<li class="chapter" data-level="" data-path="wider-reading.html"><a href="wider-reading.html"><i class="fa fa-check"></i>Wider reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="./LICENCE" target="blank">Licence: CC BY-SA 4</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Fluency</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fit-multiple-regression" class="section level2">
<h2>Using <code>lm</code> for multiple regression</h2>
<p>If you don’t already have it loaded in RStudio, load the example dataset:</p>
<!-- this not run but included to make path appear correct for students -->
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">studyhabits &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://benwhalley.github.io/rmip/data/studyhabitsandgrades.csv&#39;</span>)</a></code></pre></div>
<p>As <a href="first-lm.html#first-lm">we did for a single predictor regression</a>, we can use <code>lm</code> to get numbers to describe the
slopes of the lines.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">second.model &lt;-<span class="st"> </span><span class="kw">lm</span>(grade <span class="op">~</span><span class="st"> </span>work_hours <span class="op">*</span><span class="st"> </span>female, <span class="dt">data =</span> studyhabits)</a>
<a class="sourceLine" id="cb142-2" data-line-number="2">second.model</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = grade ~ work_hours * female, data = studyhabits)
## 
## Coefficients:
##           (Intercept)             work_hours             femaleTRUE  
##               18.0266                 1.8232                18.3918  
## work_hours:femaleTRUE  
##               -0.9444</code></pre>
<div id="explanation-of-the-lm-code-above" class="section level4">
<h4>Explanation of the <code>lm</code> code above</h4>
<p>This time we have changed the <a href="regression-extra-explanations.html#explain-formulae">formula</a> and:</p>
<ul>
<li>Added <code>female</code> as a second predictor</li>
<li>Used the <code>*</code> symbol between them, which allows the slope for <code>work_hours</code> to be <em>different</em> for
men and women.</li>
</ul>
</div>
<div id="explanation-of-the-lm-output" class="section level4">
<h4>Explanation of the <code>lm</code> output</h4>
<p>The output looks similar, but this time, we have 4 coefficients:</p>
<ul>
<li><code>(Intercept)</code></li>
<li><code>work_hours</code></li>
<li><code>femaleTRUE</code></li>
<li><code>work_hours:femaleTRUE</code></li>
</ul>
<!-- end of list -->
</div>
<div id="interpreting-the-lm-coefficients" class="section level4">
<h4>Interpreting the <code>lm</code> coefficients</h4>
<p>The coefficients have changed their meaning from model 1. But we can still think of them as either
<strong>points</strong> or <strong>slopes</strong> on the graph with fitted lines. Again, I have extended the lines to the
left to make things easier:</p>
<p><img src="04-regression_files/figure-html/unnamed-chunk-53-1.png" width="480" /></p>
<ul>
<li><code>(Intercept)</code> is the point for men, where <code>work_hours</code> = 0 (where the red line crosses zero on
the x axis).</li>
<li><code>femaleTRUE</code> is the difference between men and women, when <code>work_hours</code> = 0 (the difference
between the blue and red lines, at the zero point on the x axis)</li>
<li><code>work_hours</code> is the slope (relationship) between <code>work_hours</code> and <code>grade</code> <em>for men</em> (the
steepness of the red line)</li>
<li><code>work_hours:femaleTRUE</code> is the <em>difference in slopes</em> for work hours, for women. So this is the
slope for women <em>minus</em> the slope for men (that is, the difference in steepness between the red
and blue lines. It’s NOT the slope of the blue line).</li>
</ul>
<div class="exercise">
<p>Double check you understand how to interpret the <code>work_hours:femaleTRUE</code> coefficient. It’s very
common for regression coefficients to represent <strong>differences</strong> in this way. But in this example it
does mean we have to know both <code>work_hours</code> (the slope for men) and <code>work_hours:femaleTRUE</code> (the
difference in slopes for men and women) to be able to work out the slope for women.</p>
<p>To test your knowledge:</p>
<ul>
<li>What is the slope for women in <code>second.model</code> above? <span id="Q990204" class="webex-fitb"><input class='solveme  nospaces calculator' data-digits=4 size=3  style='width:3em;'  data-answer='["0.9",".9"]'/><span class="solvedme"></span></span></li>
</ul>
<div class="solution">
<button>
Show answer
</button>
<p>To get the answer we need to add the slope for <code>work_hours</code> to the coefficient <code>work_hours:femaleTRUE</code>.</p>
<ul>
<li><code>work_hours</code> represents the slope for men</li>
<li><code>work_hours:femaleTRUE</code> represents the difference in slopes between men and women</li>
</ul>
<p>So the slope for women = <span class="math inline">\(1.8231526 + -0.9443829 = 0.8787697\)</span> (you can round this to 0.9).</p>
</div>
</div>
</div>
<div id="linking-coefficients-with-plots" class="section level3">
<h3>Linking coefficients with plots</h3>
<div class="exercise">
<p>Compare the model output below with the plot:</p>
<pre><code>## 
## Call:
## lm(formula = grade ~ work_hours * female, data = studyhabits)
## 
## Coefficients:
##           (Intercept)             work_hours             femaleTRUE  
##               18.0266                 1.8232                18.3918  
## work_hours:femaleTRUE  
##               -0.9444</code></pre>
<p><img src="04-regression_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>As a group:</p>
<ol style="list-style-type: decimal">
<li>For each of the 4 coefficients, agree if it represents a point or a slope</li>
<li>Find each of the points on the plot (i.e. which coefficient is it)</li>
<li>Compare the slope coefficients to the lines on the plot - can you explain which coefficient
describes which slope?</li>
<li>What would happen if the sign of each coefficient was reversed? E.g. if one of the coefficients
was now a negative number rather than positive? What would this mean for the plot?</li>
</ol>
</div>
</div>
<div id="making-predictions" class="section level3">
<h3>Making predictions</h3>
<p><a href="regresion-hand-predictions.html#making-predictions-1">As before</a>, we can use <code>augment</code> from the <code>broom</code> package to make
predictions.</p>
<p>The steps are the same:</p>
<ol start="0" style="list-style-type: decimal">
<li>Fit the model we want</li>
<li>Load the <code>broom</code> package</li>
<li>Create a new dataframe with a small number of rows, including only the values of the predictor
variables we want predictions for</li>
<li>Use <code>augment</code> with the model and new dataframe</li>
</ol>
<p>Optionally, we can then plot the results.</p>
<hr />
<p>We have already fit the model we want to use, which was:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">second.model<span class="op">$</span>call</a></code></pre></div>
<pre><code>## lm(formula = grade ~ work_hours * female, data = studyhabits)</code></pre>
<p>Next we should load the broom package:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">library</span>(broom)</a></code></pre></div>
<p>And make a dataframe (a tibble is a kind of dataframe) with values of the predictor variables that would be of interest, or would provide good exemplars.</p>
<p>For example, lets say we want predictions for men and women, who work either 20 or 40 hours each. We can write this out by hand:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1">newdatatopredict =<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb148-2" data-line-number="2">  <span class="dt">female=</span><span class="kw">c</span>(<span class="ot">TRUE</span>,<span class="ot">TRUE</span>, <span class="ot">FALSE</span>,<span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb148-3" data-line-number="3">  <span class="dt">work_hours=</span><span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">40</span>, <span class="dv">20</span>,<span class="dv">40</span>)</a>
<a class="sourceLine" id="cb148-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb148-5" data-line-number="5"></a>
<a class="sourceLine" id="cb148-6" data-line-number="6">newdatatopredict</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   female work_hours
##   &lt;lgl&gt;       &lt;dbl&gt;
## 1 TRUE           20
## 2 TRUE           40
## 3 FALSE          20
## 4 FALSE          40</code></pre>
<p>The last step is to pass the model and the new dataframe to <code>augment</code>:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">second.model.predictions &lt;-<span class="st"> </span><span class="kw">augment</span>(second.model, <span class="dt">newdata=</span>newdatatopredict)</a>
<a class="sourceLine" id="cb150-2" data-line-number="2">second.model.predictions</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   female work_hours .fitted .se.fit
##   &lt;lgl&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 TRUE           20    54.0    1.02
## 2 TRUE           40    71.6    2.14
## 3 FALSE          20    54.5    1.73
## 4 FALSE          40    91.0    8.67</code></pre>
<p>And we can plot these new predictions using ggplot:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">second.model.predictions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(work_hours, .fitted, <span class="dt">color=</span>female)) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="04-regression_files/figure-html/unnamed-chunk-61-1.png" width="288" /></p>
<hr />
<p>This basic plot is OK, but we can improve it by:</p>
<ul>
<li>Adding lines to emphasise the difference in slopes for men and women.</li>
<li>Adding error bars.</li>
<li>Tidying the axis labels.</li>
</ul>
<p>To add lines to the plot we can use <code>geom_line()</code>. We have to add an additional argument called
<code>group</code> to the <code>aes()</code> section of the plot. This tells <code>ggplot</code> which points should be connected by
the lines:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1">second.model.predictions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(work_hours, .fitted, <span class="dt">color=</span>female, <span class="dt">group=</span>female)) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb153-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="04-regression_files/figure-html/unnamed-chunk-62-1.png" width="288" /></p>
<p>Next we can add error bars. If we look at the datafram that <code>augment</code> produced, there is a column
called <code>.se.fit</code>. This is short for <strong>standard error of the predicted value</strong>:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">second.model.predictions</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   female work_hours .fitted .se.fit
##   &lt;lgl&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 TRUE           20    54.0    1.02
## 2 TRUE           40    71.6    2.14
## 3 FALSE          20    54.5    1.73
## 4 FALSE          40    91.0    8.67</code></pre>
<p>We can use a new <code>geom_</code> function with this column to add error bars to the plot. The
<code>geom_errorbar</code> needs two additional bits of information inside the <code>aes()</code> section. These are
<code>ymin</code> and <code>ymax</code>, which represent the bottom and top of the error bars, respectively:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">second.model.predictions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb156-3" data-line-number="3">    <span class="dt">x=</span>work_hours,</a>
<a class="sourceLine" id="cb156-4" data-line-number="4">    <span class="dt">y=</span>.fitted,</a>
<a class="sourceLine" id="cb156-5" data-line-number="5">    <span class="dt">ymin =</span>.fitted <span class="op">-</span><span class="st"> </span>.se.fit,</a>
<a class="sourceLine" id="cb156-6" data-line-number="6">    <span class="dt">ymax =</span>.fitted <span class="op">+</span><span class="st"> </span>.se.fit,</a>
<a class="sourceLine" id="cb156-7" data-line-number="7">    <span class="dt">color=</span>female,</a>
<a class="sourceLine" id="cb156-8" data-line-number="8">    <span class="dt">group=</span>female)) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb156-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb156-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">width=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="04-regression_files/figure-html/unnamed-chunk-64-1.png" width="288" /></p>
<p><strong>Explanation of the code</strong>: We added the <code>geom_errorbar</code> function to our existing plot. We also
added two new arguments to the <code>aes()</code> section: <code>ymin</code> and <code>ymax</code>. We set the <code>ymin</code> value to the
fitted value, <strong><em>minus</em></strong> the standard error of the fitted value (and the same for <code>ymax</code>, except we
added on the SE).</p>
<p><strong>Explanation of the resulting plot</strong>: The plot now includes error bars which represent the <a href="https://en.wikipedia.org/wiki/Standard_error">standard
error</a> of the fitted values. We will cover more on intervals, including standard errors, in a later workshop.</p>
</div>
<div id="extension-exercises-1" class="section level3">
<h3>Extension exercises</h3>
<div class="exercise">
<ol style="list-style-type: decimal">
<li><p>Tidy up the plot above by adding axis labels.</p></li>
<li><p>In the example above we created a dataframe by hand to tell <code>augment</code> what predictions we wanted.
Now try using <a href="sequences-and-designs.html#expand-grid"><code>expand.grid</code></a> to make the new dataframe instead (we first used
<code>expand.grid</code> in the <a href="sequences-and-designs.html#expand-grid">first session</a>). For example, try making predictions for men
and women who work 20, 25, 30, 35, or 40 hours per week.</p></li>
</ol>
</div>
<div class="exercise">
<p>Data from a clinical trial of Functional Imagery Training <span class="citation">(Solbrig et al. <a href="#ref-solbrig2019functional">2019</a>, FIT)</span> are
available at <a href="https://zenodo.org/record/1120364/files/blind_data.csv" class="uri">https://zenodo.org/record/1120364/files/blind_data.csv</a>. In this file, <code>group</code>
represents the treatment group (FIT=2, motivational interviewing=1). The <code>kg1</code> and <code>kg3</code> variables
represent the patients’ weights in kilograms before and after treatment, respectively. Load these
data and complete the following tasks:</p>
<ol style="list-style-type: decimal">
<li><p>Plot the difference in weight between treatment groups at followup (<code>kg3</code>)</p></li>
<li><p>Create a plot to show whether men or women benefitted most from the treatment (this will require
some thinking about what goes on the y-axis, and perhaps some pre-processing of the data).</p></li>
<li><p>Create a plot to show whether older participants benefitted more or less than younger ones (again
this will require some thinking, and there are quite a number of different plot types which could
be used, each with different pros and cons).</p></li>
</ol>
</div>
<!--


```r
fit <- read_csv('https://zenodo.org/record/1120364/files/blind_data.csv')
```

```
## Parsed with column specification:
## cols(
##   kg1 = col_double(),
##   kg2 = col_double(),
##   kg3 = col_double(),
##   cm1 = col_double(),
##   cm2 = col_double(),
##   cm3 = col_double(),
##   group = col_double(),
##   gender = col_character(),
##   age = col_double(),
##   height = col_double(),
##   gqol1 = col_double(),
##   gqol2 = col_double(),
##   ceq_logical = col_double(),
##   ceq_successfull = col_double(),
##   ceq_recommend = col_double()
## )
```

```r
fit %>% glimpse
```

```
## Observations: 121
## Variables: 15
## $ kg1             <dbl> 83.0, 86.2, 69.0, 107.8, 107.0, 99.5, 80.0, 81.0…
## $ kg2             <dbl> NA, NA, NA, 106.7, 105.4, 101.0, 79.0, 80.0, 57.…
## $ kg3             <dbl> NA, NA, NA, 106.0, 105.9, 98.8, 78.0, 80.0, 60.0…
## $ cm1             <dbl> 102.4, 99.0, 87.0, 117.0, 117.0, 110.0, 101.0, 9…
## $ cm2             <dbl> NA, NA, NA, 119.0, 111.0, 110.0, 96.0, 99.0, 76.…
## $ cm3             <dbl> NA, NA, NA, 116.0, 115.0, 109.0, 100.0, 99.0, 90…
## $ group           <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ gender          <chr> "f", "f", "f", "f", "f", "f", "f", "f", "f", "f"…
## $ age             <dbl> 20, 23, 65, 44, 32, 33, 21, 27, 56, 50, 57, 34, …
## $ height          <dbl> 1.62, 1.66, 1.61, 1.58, 1.70, 1.85, 1.60, 1.63, …
## $ gqol1           <dbl> 60, 55, 77, 70, 60, 40, 60, 40, 60, 60, 60, 60, …
## $ gqol2           <dbl> NA, NA, NA, 70, 65, 65, 70, 60, 62, 60, 70, 75, …
## $ ceq_logical     <dbl> NA, 9, 9, 9, 8, 9, 9, 9, 9, 9, 8, 9, 9, 9, 9, 8,…
## $ ceq_successfull <dbl> NA, 9, 9, 8, 9, 9, 9, 9, 8, 9, 8, 8, 9, 7, 9, 9,…
## $ ceq_recommend   <dbl> NA, 9, 9, 9, 9, 9, 9, 9, 9, 9, 8, 9, 9, 9, 9, 9,…
```

```r
fit %>% ggplot(aes(gender, kg3-kg1, color=factor(group))) + stat_summary()
```

```
## Warning: Removed 9 rows containing non-finite values (stat_summary).
```

```
## No summary function supplied, defaulting to `mean_se()
```

<img src="04-regression_files/figure-html/unnamed-chunk-65-1.png" width="672" />

```r
fit %>% ggplot(aes(age>45, kg3-kg1, color=factor(group))) + stat_summary()
```

```
## Warning: Removed 9 rows containing non-finite values (stat_summary).
```

```
## No summary function supplied, defaulting to `mean_se()
```

<img src="04-regression_files/figure-html/unnamed-chunk-65-2.png" width="672" />

```r
m1 <- lm(kg3 ~ group*gender, data=fit)
augment(m1, newdata=expand.grid(group=c(1,2), gender=c("f", "m"))) %>%
  ggplot(aes(gender, .fitted, ymin=.fitted-.se.fit, ymax=.fitted+.se.fit, colour=factor(group))) +
    geom_point() +
    geom_errorbar(width=.5)
```

<img src="04-regression_files/figure-html/unnamed-chunk-65-3.png" width="672" />

-->

</div>
</div>
<!-- </div> -->
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-solbrig2019functional">
<p>Solbrig, Linda, Ben Whalley, David J Kavanagh, Jon May, Tracey Parkin, Ray Jones, and Jackie Andrade. 2019. “Functional Imagery Training Versus Motivational Interviewing for Weight Loss: A Randomised Controlled Trial of Brief Individual Interventions for Overweight and Obesity.” <em>International Journal of Obesity</em> 43 (4). Nature Publishing Group: 883. <a href="https://www.ncbi.nlm.nih.gov/pubmed/30185920" class="uri">https://www.ncbi.nlm.nih.gov/pubmed/30185920</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="regression-interaction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="uncertainty.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
